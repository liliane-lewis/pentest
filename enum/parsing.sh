#!/bin/bash

# Exericio de bash script. Aula: Parsing HTML
# Objetivo: Identificar possiveis hosts em um dominio
# O usuario deve informar o dominio e caso o site possua subdominios na pagina, deve retornar o IP dos hosts
#TODO: incluir executar script novamente
if [ "$1" == '' ]
then
    echo "PARSHING HTML"
    echo "Modo de uso $0 dominio"
    echo "Exemplo de  uso: $0 exemplo.com.br"
else
    echo -e "\e[35m=================================================="
    echo -e "\e[32m      [+] Resolvendo URLs em: \e[0m \e[36m$1 \e[0m"
    echo -e "\e[35m==================================================\e[0m"
    rm index*
    wget $1  -q  #salva index.html
    grep href index.html | cut -d '/' -f 3 | grep '\.' | cut -d '"' -f 1 | grep -v "<l"> lista_subdominios
    i=1
    echo -e "\e[31m[+] Concluido: Salvando resultado em: $1.txt\e[0m"
    echo -e "\e[35m==================================================\e[0m"
     echo -e "\t Line \t\t IP \t\t ADDRESS"
    for sub in $(cat lista_subdominios);
       do
            ip=$(host $sub | cut -d " " -f 4)
            echo -e "\t $i \t $ip \t\t $sub"
                
       
             let "i=i+1"
       
        done
     echo -e "\e[35m==================================================\e[0m"
     
     
    echo -e "\e[35m==================================================\e[0m"
    echo -e "\e[32m  - Nova Pesquisa? y/n\e[0m"
    read pes
 #for host in {1..254};
    #do
    #    ping -c 1 $1.$host | grep "64 bytes" | cut -d ":" -f 1 | cut -d " " -f 4;
    #done
fi
