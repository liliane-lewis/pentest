import socket
import sys
import dns.zone
import dns.resolver
import dns.query

def zone_transfer(domain,ns):
        print("Trying zone transfer  " + str(ns))
        ip = socket.gethostbyname(str(ns))
        try:
                zone = dns.zone.from_xfr(dns.query.xfr(ip,domain))
                print("Zone transfer sucessful using nameserver " +  str(ns) )
                names = list(zone.nodes.keys())#
                names.sort()
                for n in names:
                        print(zone[n].to_text(n))    # Print raw zone#
        except Exception:
                pass

def get_ns(domain):
        answer = dns.resolver.resolve(domain, 'NS')
        ns = []
        for a in answer:
                ns.append(a)
        return ns

if __name__ == '__main__':
        if len(sys.argv) <= 1:
                print("Use: python3 dns_transfer.py domain")
                exit
        domain = sys.argv[1]
        nservers = get_ns(domain)
        for ns in nservers:
                zone_transfer(domain,ns)
